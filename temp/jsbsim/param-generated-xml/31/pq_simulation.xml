<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="http://jsbsim.sf.net/JSBSimScript.xsl"?>
<runscript xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="http://jsbsim.sf.net/JSBSimScript.xsd"
    name="Rocket flight.">


  <use aircraft="PQ_ROCKET" initialize="liftoff"/> 

  <run start="0" end="300.0" dt="0.001">

    

    <!-- start off on the ground -->
    <property value="1"> forces/hold-down </property>

    <property value="0"> simulation/notify-time-trigger </property>

    <property value="100000000"> simulation/parachute_deploy_time </property>



    <!-- Ignite -->
    <event name="Ignition">
        <condition>simulation/sim-time-sec  ge  0.1</condition>
        <notify/>
    </event>

    <!-- Liftoff -->
    <event name="liftoff">
      <condition>simulation/sim-time-sec  ge  0.1</condition>
      <set name="forces/hold-down" value="0"/>
    </event>

    <!-- Burnout -->
    <event name="Motor Burnout">
      <condition>propulsion/tank[0]/contents-lbs lt 0.1</condition>
      <notify>
        <property caption="Time [s]">  simulation/sim-time-sec  </property>
        <property caption="Altitude [m]"> position/h-sl-meters  </property>
      </notify>
    </event>

    <!-- Zero Vertical Velocity -->
    <event name="Apogee">
      <condition>velocities/v-down-fps gt 1</condition>
      <notify>
        <property caption="Time [s]">  simulation/sim-time-sec  </property>
        <property caption="Altitude [m]"> position/h-sl-meters  </property>
      </notify>
      <set name="simulation/parachute_deploy_time" >
        <function>
          <sum>
            <property>simulation/sim-time-sec</property>
            <value>1.0</value>
          </sum>
        </function>
      </set>
    </event>

    <event name="Landed">
      <condition>position/h-agl-ft le 0.1</condition>
      <notify>
        <property caption="Time [s]">  simulation/sim-time-sec  </property>
        <property caption="Altitude [m]"> position/h-sl-meters  </property>
      </notify>
      <set name="simulation/terminate" value="1"/>
    </event>

    <event name="Winds aloft" continuous="true">
      <condition>simulation/sim-time-sec ge 0.001</condition>
      <set name="atmosphere/psiw-rad">
      <function>
      <table>
      <independentVar lookup="row"> position/h-agl-ft </independentVar>
      <tableData>
        0.0 2.3561955
        100.0 2.3561955
        200.0 2.3561955
        300.0 2.3561955
        400.0 2.3561955
        500.0 2.3561955
        600.0 2.3561955
        700.0 2.3561955
        800.0 2.3561955
        900.0 2.3561955
        1000.0 2.3561955
        1100.0 2.3561955
        1200.0 2.3561955
        1300.0 2.3561955
        1400.0 2.3561955
        1500.0 2.3561955
        1600.0 2.3561955
        1700.0 2.3561955
        1800.0 2.3561955
        1900.0 2.3561955
        2000.0 2.3561955
        2100.0 2.3561955
        2200.0 2.3561955
        2300.0 2.3561955
        2400.0 2.3561955
        2500.0 2.3561955
        2600.0 2.3561955
        2700.0 2.3561955
        2800.0 2.3561955
        2900.0 2.3561955
        3000.0 2.3561955
        3100.0 2.3561955
        3200.0 2.3561955
        3300.0 2.3561955
        3400.0 2.3561955
        3500.0 2.3561955
        3600.0 2.3561955
        3700.0 2.3561955
        3800.0 2.3561955
        3900.0 2.3561955
        4000.0 2.3561955
        4100.0 2.3561955
        4200.0 2.3561955
        4300.0 2.3561955
        4400.0 2.3561955
        4500.0 2.3561955
        4600.0 2.3561955
        4700.0 2.3561955
        4800.0 2.3561955
        4900.0 2.3561955
        5000.0 2.3561955
        5100.0 2.3561955
        5200.0 2.3561955
        5300.0 2.3561955
        5400.0 2.3561955
        5500.0 2.3561955
        5600.0 2.3561955
        5700.0 2.3561955
        5800.0 2.3561955
        5900.0 2.3561955
        6000.0 2.3561955
        6100.0 2.3561955
        6200.0 2.3561955
        6300.0 2.3561955
        6400.0 2.3561955
        6500.0 2.3561955
        6600.0 2.3561955
        6700.0 2.3561955
        6800.0 2.3561955
        6900.0 2.3561955
        7000.0 2.3561955
        7100.0 2.3561955
        7200.0 2.3561955
        7300.0 2.3561955
        7400.0 2.3561955
        7500.0 2.3561955
        7600.0 2.3561955
        7700.0 2.3561955
        7800.0 2.3561955
        7900.0 2.3561955
        8000.0 2.3561955
        8100.0 2.3561955
        8200.0 2.3561955
        8300.0 2.3561955
        8400.0 2.3561955
        8500.0 2.3561955
        8600.0 2.3561955
        8700.0 2.3561955
        8800.0 2.3561955
        8900.0 2.3561955
        9000.0 2.3561955
        9100.0 2.3561955
        9200.0 2.3561955
        9300.0 2.3561955
        9400.0 2.3561955
        9500.0 2.3561955
        9600.0 2.3561955
        9700.0 2.3561955
        9800.0 2.3561955
        9900.0 2.3561955
        10000.0 2.3561955
        
      </tableData>
      </table>
      </function>
      </set>
      <set name="atmosphere/wind-mag-fps">
      <function>
      <table>
      <independentVar lookup="row"> position/h-agl-ft </independentVar>
      <tableData>
        0.0 0.0
        100.0 37.471725726589476
        200.0 42.06058806914274
        300.0 45.001176903357475
        400.0 47.211411655556226
        500.0 49.00028981780545
        600.0 50.51211086911987
        700.0 51.826670766071494
        800.0 52.993015381675306
        900.0 54.043572411459124
        1000.0 55.00096313506259
        1100.0 55.88163092911762
        1200.0 56.697924810581924
        1300.0 57.459368115560935
        1400.0 58.17346833695502
        1500.0 58.84625454658892
        1600.0 59.482645842723436
        1700.0 60.08671104874176
        1800.0 60.661856183749286
        1900.0 61.21096263691167
        2000.0 61.73649088673896
        2100.0 62.240559628165315
        2200.0 62.72500701705492
        2300.0 63.19143869274059
        2400.0 63.64126587692561
        2500.0 64.07573592281042
        2600.0 64.49595704920867
        2700.0 64.90291854510845
        2800.0 65.29750740937335
        2900.0 65.68052215804849
        3000.0 66.05268436141675
        3100.0 66.41464834654417
        3200.0 66.76700940619332
        3300.0 67.11031078306934
        3400.0 67.44504964332097
        3500.0 67.77168221071481
        3600.0 68.09062819980463
        3700.0 68.40227466044654
        3800.0 68.7069793254797
        3900.0 69.00507353705054
        4000.0 69.29686481396679
        4100.0 69.58263911191396
        4200.0 69.8626628198115
        4300.0 70.13718452860992
        4400.0 70.40643660311498
        4500.0 70.67063658271701
        4600.0 70.92998843300825
        4700.0 71.18468366703429
        4800.0 71.43490235222183
        4900.0 71.68081401676183
        5000.0 71.92257846731934
        5100.0 72.16034652833312
        5200.0 72.39426071180287
        5300.0 72.6244558253022
        5400.0 72.85105952496497
        5500.0 73.07419281934484
        5600.0 73.29397052932102
        5700.0 73.5105017085952
        5800.0 73.72389002878509
        5900.0 73.93423413264992
        6000.0 74.14162795857756
        6100.0 74.34616103910857
        6200.0 74.5479187759633
        6300.0 74.74698269376884
        6400.0 74.94343067444501
        6500.0 75.13733717400139
        6600.0 75.32877342331406
        6700.0 75.51780761428921
        6800.0 75.70450507267837
        6900.0 75.88892841868343
        7000.0 76.07113771637779
        7100.0 76.25119061287
        7200.0 76.42914246804827
        7300.0 76.60504647566412
        7400.0 76.77895377644403
        7500.0 76.9509135638534
        7600.0 77.1209731830819
        7700.0 77.2891782237672
        7800.0 77.45557260692912
        7900.0 77.62019866654514
        8000.0 77.78309722616049
        8100.0 77.9443076708935
        8200.0 78.1038680151657
        8300.0 78.26181496645985
        8400.0 78.41818398538307
        8500.0 78.57300934229096
        8600.0 78.72632417070723
        8700.0 78.87816051775543
        8800.0 79.02854939180196
        8900.0 79.17752080749446
        9000.0 79.3251038283656
        9100.0 79.47132660715921
        9200.0 79.61621642402412
        9300.0 79.75979972271043
        9400.0 79.90210214489288
        9500.0 80.04314856273693
        9600.0 80.1829631098152
        9700.0 80.32156921047408
        9800.0 80.45898960774284
        9900.0 80.59524638987244
        10000.0 80.73036101558398
        
      </tableData>
      </table>
      </function>
      </set>
      <notify/>
    </event>


  </run>

  <output name="pq_rocket_output_raw.csv" type="CSV" rate="100" file="unitconversions.xml">
    <property>position/lat-gc-deg</property>
    <property>position/long-gc-deg</property>
    <property>position/h-sl-meters</property>
    <property>aero/alpha-rad</property>
    <property apply="convert-fps-To-ms" caption="velocities/vtrue-ms">velocities/vtrue-fps</property>
    <property apply="convert-fps-To-m_s" caption="velocities/vg-ms">velocities/vg-fps</property>
    <property apply="convert-rad-To-deg" caption="attitude/phi-deg">attitude/phi-rad</property>
    <property apply="convert-rad-To-deg" caption="attitude/theta-deg">attitude/theta-rad</property>
    <property apply="convert-rad-To-deg" caption="attitude/psi-deg">attitude/psi-rad</property>
    <property apply="convert-psf-To-Pa" caption="aero/qbar-Pa">aero/qbar-psf</property>
  </output>
</runscript>