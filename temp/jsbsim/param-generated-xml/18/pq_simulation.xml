<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="http://jsbsim.sf.net/JSBSimScript.xsl"?>
<runscript xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="http://jsbsim.sf.net/JSBSimScript.xsd"
    name="Rocket flight.">


  <use aircraft="PQ_ROCKET" initialize="liftoff"/> 

  <run start="0" end="300.0" dt="0.001">

    

    <!-- start off on the ground -->
    <property value="1"> forces/hold-down </property>

    <property value="0"> simulation/notify-time-trigger </property>

    <property value="100000000"> simulation/parachute_deploy_time </property>



    <!-- Ignite -->
    <event name="Ignition">
        <condition>simulation/sim-time-sec  ge  0.1</condition>
        <notify/>
    </event>

    <!-- Liftoff -->
    <event name="liftoff">
      <condition>simulation/sim-time-sec  ge  0.1</condition>
      <set name="forces/hold-down" value="0"/>
    </event>

    <!-- Burnout -->
    <event name="Motor Burnout">
      <condition>propulsion/tank[0]/contents-lbs lt 0.1</condition>
      <notify>
        <property caption="Time [s]">  simulation/sim-time-sec  </property>
        <property caption="Altitude [m]"> position/h-sl-meters  </property>
      </notify>
    </event>

    <!-- Zero Vertical Velocity -->
    <event name="Apogee">
      <condition>velocities/v-down-fps gt 1</condition>
      <notify>
        <property caption="Time [s]">  simulation/sim-time-sec  </property>
        <property caption="Altitude [m]"> position/h-sl-meters  </property>
      </notify>
      <set name="simulation/parachute_deploy_time" >
        <function>
          <sum>
            <property>simulation/sim-time-sec</property>
            <value>1.0</value>
          </sum>
        </function>
      </set>
    </event>

    <event name="Landed">
      <condition>position/h-agl-ft le 0.1</condition>
      <notify>
        <property caption="Time [s]">  simulation/sim-time-sec  </property>
        <property caption="Altitude [m]"> position/h-sl-meters  </property>
      </notify>
      <set name="simulation/terminate" value="1"/>
    </event>

    <event name="Winds aloft" continuous="true">
      <condition>simulation/sim-time-sec ge 0.001</condition>
      <set name="atmosphere/psiw-rad">
      <function>
      <table>
      <independentVar lookup="row"> position/h-agl-ft </independentVar>
      <tableData>
        0.0 1.5707970000000002
        100.0 1.5707970000000002
        200.0 1.5707970000000002
        300.0 1.5707970000000002
        400.0 1.5707970000000002
        500.0 1.5707970000000002
        600.0 1.5707970000000002
        700.0 1.5707970000000002
        800.0 1.5707970000000002
        900.0 1.5707970000000002
        1000.0 1.5707970000000002
        1100.0 1.5707970000000002
        1200.0 1.5707970000000002
        1300.0 1.5707970000000002
        1400.0 1.5707970000000002
        1500.0 1.5707970000000002
        1600.0 1.5707970000000002
        1700.0 1.5707970000000002
        1800.0 1.5707970000000002
        1900.0 1.5707970000000002
        2000.0 1.5707970000000002
        2100.0 1.5707970000000002
        2200.0 1.5707970000000002
        2300.0 1.5707970000000002
        2400.0 1.5707970000000002
        2500.0 1.5707970000000002
        2600.0 1.5707970000000002
        2700.0 1.5707970000000002
        2800.0 1.5707970000000002
        2900.0 1.5707970000000002
        3000.0 1.5707970000000002
        3100.0 1.5707970000000002
        3200.0 1.5707970000000002
        3300.0 1.5707970000000002
        3400.0 1.5707970000000002
        3500.0 1.5707970000000002
        3600.0 1.5707970000000002
        3700.0 1.5707970000000002
        3800.0 1.5707970000000002
        3900.0 1.5707970000000002
        4000.0 1.5707970000000002
        4100.0 1.5707970000000002
        4200.0 1.5707970000000002
        4300.0 1.5707970000000002
        4400.0 1.5707970000000002
        4500.0 1.5707970000000002
        4600.0 1.5707970000000002
        4700.0 1.5707970000000002
        4800.0 1.5707970000000002
        4900.0 1.5707970000000002
        5000.0 1.5707970000000002
        5100.0 1.5707970000000002
        5200.0 1.5707970000000002
        5300.0 1.5707970000000002
        5400.0 1.5707970000000002
        5500.0 1.5707970000000002
        5600.0 1.5707970000000002
        5700.0 1.5707970000000002
        5800.0 1.5707970000000002
        5900.0 1.5707970000000002
        6000.0 1.5707970000000002
        6100.0 1.5707970000000002
        6200.0 1.5707970000000002
        6300.0 1.5707970000000002
        6400.0 1.5707970000000002
        6500.0 1.5707970000000002
        6600.0 1.5707970000000002
        6700.0 1.5707970000000002
        6800.0 1.5707970000000002
        6900.0 1.5707970000000002
        7000.0 1.5707970000000002
        7100.0 1.5707970000000002
        7200.0 1.5707970000000002
        7300.0 1.5707970000000002
        7400.0 1.5707970000000002
        7500.0 1.5707970000000002
        7600.0 1.5707970000000002
        7700.0 1.5707970000000002
        7800.0 1.5707970000000002
        7900.0 1.5707970000000002
        8000.0 1.5707970000000002
        8100.0 1.5707970000000002
        8200.0 1.5707970000000002
        8300.0 1.5707970000000002
        8400.0 1.5707970000000002
        8500.0 1.5707970000000002
        8600.0 1.5707970000000002
        8700.0 1.5707970000000002
        8800.0 1.5707970000000002
        8900.0 1.5707970000000002
        9000.0 1.5707970000000002
        9100.0 1.5707970000000002
        9200.0 1.5707970000000002
        9300.0 1.5707970000000002
        9400.0 1.5707970000000002
        9500.0 1.5707970000000002
        9600.0 1.5707970000000002
        9700.0 1.5707970000000002
        9800.0 1.5707970000000002
        9900.0 1.5707970000000002
        10000.0 1.5707970000000002
        
      </tableData>
      </table>
      </function>
      </set>
      <set name="atmosphere/wind-mag-fps">
      <function>
      <table>
      <independentVar lookup="row"> position/h-agl-ft </independentVar>
      <tableData>
        0.0 0.0
        100.0 10.706207350454138
        200.0 12.017310876897925
        300.0 12.857479115244992
        400.0 13.488974758730349
        500.0 14.000082805087272
        600.0 14.432031676891391
        700.0 14.807620218877569
        800.0 15.140861537621518
        900.0 15.44102068898832
        1000.0 15.71456089573217
        1100.0 15.966180265462176
        1200.0 16.199407088737694
        1300.0 16.416962318731695
        1400.0 16.620990953415717
        1500.0 16.81321558473969
        1600.0 16.99504166934955
        1700.0 17.167631728211934
        1800.0 17.331958909642655
        1900.0 17.488846467689047
        2000.0 17.638997396211135
        2100.0 17.78301703661866
        2200.0 17.921430576301404
        2300.0 18.054696769354457
        2400.0 18.183218821978745
        2500.0 18.30735312080298
        2600.0 18.42741629977391
        2700.0 18.543691012888125
        2800.0 18.65643068839239
        2900.0 18.76586347372814
        3000.0 18.872195531833356
        3100.0 18.975613813298335
        3200.0 19.07628840176952
        3300.0 19.17437450944838
        3400.0 19.27001418380599
        3500.0 19.363337774489946
        3600.0 19.454465199944178
        3700.0 19.543507045841867
        3800.0 19.630565521565625
        3900.0 19.715735296300156
        4000.0 19.799104232561938
        4100.0 19.88075403197542
        4200.0 19.96076080566043
        4300.0 20.039195579602836
        4400.0 20.116124743747136
        4500.0 20.191610452204856
        4600.0 20.265710980859502
        4700.0 20.338481047724084
        4800.0 20.409972100634807
        4900.0 20.480232576217663
        5000.0 20.549308133519816
        5100.0 20.617241865238036
        5200.0 20.684074489086534
        5300.0 20.749844521514916
        5400.0 20.814588435704273
        5500.0 20.8783408055271
        5600.0 20.94113443694886
        5700.0 21.003000488170056
        5800.0 21.063968579652883
        5900.0 21.124066895042834
        6000.0 21.183322273879302
        6100.0 21.241760296888163
        6200.0 21.29940536456094
        6300.0 21.35628076964824
        6400.0 21.412408764127147
        6500.0 21.467810621143254
        6600.0 21.522506692375444
        6700.0 21.576516461225488
        6800.0 21.62985859219382
        6900.0 21.682550976766695
        7000.0 21.73461077610794
        7100.0 21.78605446082
        7200.0 21.83689784801379
        7300.0 21.887156135904036
        7400.0 21.936843936126866
        7500.0 21.985975303958117
        7600.0 22.034563766594832
        7700.0 22.08262234964777
        7800.0 22.13016360197975
        7900.0 22.177199619012896
        8000.0 22.223742064617284
        8100.0 22.269802191683855
        8200.0 22.315390861475915
        8300.0 22.360518561845673
        8400.0 22.405195424395163
        8500.0 22.449431240654558
        8600.0 22.49323547734492
        8700.0 22.536617290787266
        8800.0 22.579585540514845
        8900.0 22.622148802141275
        9000.0 22.66431537953303
        9100.0 22.706093316331202
        9200.0 22.74749040686403
        9300.0 22.788514206488692
        9400.0 22.829172041397964
        9500.0 22.869471017924834
        9600.0 22.909418031375775
        9700.0 22.949019774421163
        9800.0 22.988282745069377
        9900.0 23.027213254249272
        10000.0 23.065817433023994
        
      </tableData>
      </table>
      </function>
      </set>
      <notify/>
    </event>


  </run>

  <output name="pq_rocket_output_raw.csv" type="CSV" rate="100" file="unitconversions.xml">
    <property>position/lat-gc-deg</property>
    <property>position/long-gc-deg</property>
    <property>position/h-sl-meters</property>
    <property>aero/alpha-rad</property>
    <property apply="convert-fps-To-ms" caption="velocities/vtrue-ms">velocities/vtrue-fps</property>
    <property apply="convert-fps-To-m_s" caption="velocities/vg-ms">velocities/vg-fps</property>
    <property apply="convert-rad-To-deg" caption="attitude/phi-deg">attitude/phi-rad</property>
    <property apply="convert-rad-To-deg" caption="attitude/theta-deg">attitude/theta-rad</property>
    <property apply="convert-rad-To-deg" caption="attitude/psi-deg">attitude/psi-rad</property>
    <property apply="convert-psf-To-Pa" caption="aero/qbar-Pa">aero/qbar-psf</property>
  </output>
</runscript>