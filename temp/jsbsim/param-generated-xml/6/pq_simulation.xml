<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="http://jsbsim.sf.net/JSBSimScript.xsl"?>
<runscript xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="http://jsbsim.sf.net/JSBSimScript.xsd"
    name="Rocket flight.">


  <use aircraft="PQ_ROCKET" initialize="liftoff"/> 

  <run start="0" end="300.0" dt="0.001">

    

    <!-- start off on the ground -->
    <property value="1"> forces/hold-down </property>

    <property value="0"> simulation/notify-time-trigger </property>

    <property value="100000000"> simulation/parachute_deploy_time </property>



    <!-- Ignite -->
    <event name="Ignition">
        <condition>simulation/sim-time-sec  ge  0.1</condition>
        <notify/>
    </event>

    <!-- Liftoff -->
    <event name="liftoff">
      <condition>simulation/sim-time-sec  ge  0.1</condition>
      <set name="forces/hold-down" value="0"/>
    </event>

    <!-- Burnout -->
    <event name="Motor Burnout">
      <condition>propulsion/tank[0]/contents-lbs lt 0.1</condition>
      <notify>
        <property caption="Time [s]">  simulation/sim-time-sec  </property>
        <property caption="Altitude [m]"> position/h-sl-meters  </property>
      </notify>
    </event>

    <!-- Zero Vertical Velocity -->
    <event name="Apogee">
      <condition>velocities/v-down-fps gt 1</condition>
      <notify>
        <property caption="Time [s]">  simulation/sim-time-sec  </property>
        <property caption="Altitude [m]"> position/h-sl-meters  </property>
      </notify>
      <set name="simulation/parachute_deploy_time" >
        <function>
          <sum>
            <property>simulation/sim-time-sec</property>
            <value>1.0</value>
          </sum>
        </function>
      </set>
    </event>

    <event name="Landed">
      <condition>position/h-agl-ft le 0.1</condition>
      <notify>
        <property caption="Time [s]">  simulation/sim-time-sec  </property>
        <property caption="Altitude [m]"> position/h-sl-meters  </property>
      </notify>
      <set name="simulation/terminate" value="1"/>
    </event>

    <event name="Winds aloft" continuous="true">
      <condition>simulation/sim-time-sec ge 0.001</condition>
      <set name="atmosphere/psiw-rad">
      <function>
      <table>
      <independentVar lookup="row"> position/h-agl-ft </independentVar>
      <tableData>
        0.0 0.0
        100.0 0.0
        200.0 0.0
        300.0 0.0
        400.0 0.0
        500.0 0.0
        600.0 0.0
        700.0 0.0
        800.0 0.0
        900.0 0.0
        1000.0 0.0
        1100.0 0.0
        1200.0 0.0
        1300.0 0.0
        1400.0 0.0
        1500.0 0.0
        1600.0 0.0
        1700.0 0.0
        1800.0 0.0
        1900.0 0.0
        2000.0 0.0
        2100.0 0.0
        2200.0 0.0
        2300.0 0.0
        2400.0 0.0
        2500.0 0.0
        2600.0 0.0
        2700.0 0.0
        2800.0 0.0
        2900.0 0.0
        3000.0 0.0
        3100.0 0.0
        3200.0 0.0
        3300.0 0.0
        3400.0 0.0
        3500.0 0.0
        3600.0 0.0
        3700.0 0.0
        3800.0 0.0
        3900.0 0.0
        4000.0 0.0
        4100.0 0.0
        4200.0 0.0
        4300.0 0.0
        4400.0 0.0
        4500.0 0.0
        4600.0 0.0
        4700.0 0.0
        4800.0 0.0
        4900.0 0.0
        5000.0 0.0
        5100.0 0.0
        5200.0 0.0
        5300.0 0.0
        5400.0 0.0
        5500.0 0.0
        5600.0 0.0
        5700.0 0.0
        5800.0 0.0
        5900.0 0.0
        6000.0 0.0
        6100.0 0.0
        6200.0 0.0
        6300.0 0.0
        6400.0 0.0
        6500.0 0.0
        6600.0 0.0
        6700.0 0.0
        6800.0 0.0
        6900.0 0.0
        7000.0 0.0
        7100.0 0.0
        7200.0 0.0
        7300.0 0.0
        7400.0 0.0
        7500.0 0.0
        7600.0 0.0
        7700.0 0.0
        7800.0 0.0
        7900.0 0.0
        8000.0 0.0
        8100.0 0.0
        8200.0 0.0
        8300.0 0.0
        8400.0 0.0
        8500.0 0.0
        8600.0 0.0
        8700.0 0.0
        8800.0 0.0
        8900.0 0.0
        9000.0 0.0
        9100.0 0.0
        9200.0 0.0
        9300.0 0.0
        9400.0 0.0
        9500.0 0.0
        9600.0 0.0
        9700.0 0.0
        9800.0 0.0
        9900.0 0.0
        10000.0 0.0
        
      </tableData>
      </table>
      </function>
      </set>
      <set name="atmosphere/wind-mag-fps">
      <function>
      <table>
      <independentVar lookup="row"> position/h-agl-ft </independentVar>
      <tableData>
        0.0 0.0
        100.0 32.118622051362415
        200.0 36.05193263069378
        300.0 38.57243734573498
        400.0 40.46692427619105
        500.0 42.000248415261815
        600.0 43.296095030674174
        700.0 44.42286065663271
        800.0 45.422584612864554
        900.0 46.32306206696496
        1000.0 47.14368268719651
        1100.0 47.89854079638653
        1200.0 48.59822126621308
        1300.0 49.250886956195096
        1400.0 49.862972860247154
        1500.0 50.439646754219076
        1600.0 50.985125008048655
        1700.0 51.502895184635804
        1800.0 51.99587672892795
        1900.0 52.46653940306714
        2000.0 52.9169921886334
        2100.0 53.349051109855985
        2200.0 53.76429172890421
        2300.0 54.164090308063365
        2400.0 54.54965646593624
        2500.0 54.92205936240893
        2600.0 55.28224889932173
        2700.0 55.63107303866438
        2800.0 55.969292065177164
        2900.0 56.297590421184424
        3000.0 56.61658659550007
        3100.0 56.926841439895
        3200.0 57.228865205308566
        3300.0 57.523123528345145
        3400.0 57.81004255141798
        3500.0 58.09001332346983
        3600.0 58.363395599832536
        3700.0 58.6305211375256
        3800.0 58.89169656469688
        3900.0 59.147205888900466
        4000.0 59.39731269768582
        4100.0 59.642262095926256
        4200.0 59.88228241698129
        4300.0 60.1175867388085
        4400.0 60.348374231241415
        4500.0 60.574831356614574
        4600.0 60.79713294257851
        4700.0 61.015443143172256
        4800.0 61.22991630190442
        4900.0 61.440697728652985
        5000.0 61.64792440055945
        5100.0 61.85172559571411
        5200.0 62.052223467259594
        5300.0 62.24953356454475
        5400.0 62.44376530711283
        5500.0 62.63502241658129
        5600.0 62.82340331084659
        5700.0 63.00900146451016
        5800.0 63.19190573895865
        5900.0 63.372200685128504
        6000.0 63.54996682163791
        6100.0 63.725280890664486
        6200.0 63.89821609368282
        6300.0 64.06884230894472
        6400.0 64.23722629238144
        6500.0 64.40343186342976
        6600.0 64.56752007712635
        6700.0 64.72954938367646
        6800.0 64.88957577658147
        6900.0 65.04765293030009
        7000.0 65.20383232832381
        7100.0 65.35816338246
        7200.0 65.51069354404136
        7300.0 65.6614684077121
        7400.0 65.81053180838059
        7500.0 65.95792591187434
        7600.0 66.1036912997845
        7700.0 66.24786704894332
        7800.0 66.39049080593925
        7900.0 66.53159885703869
        8000.0 66.67122619385185
        8100.0 66.80940657505157
        8200.0 66.94617258442774
        8300.0 67.08155568553701
        8400.0 67.2155862731855
        8500.0 67.34829372196367
        8600.0 67.47970643203476
        8700.0 67.60985187236179
        8800.0 67.73875662154454
        8900.0 67.86644640642382
        9000.0 67.9929461385991
        9100.0 68.1182799489936
        9200.0 68.2424712205921
        9300.0 68.36554261946608
        9400.0 68.48751612419389
        9500.0 68.60841305377451
        9600.0 68.72825409412732
        9700.0 68.8470593232635
        9800.0 68.96484823520814
        9900.0 69.08163976274781
        10000.0 69.19745229907198
        
      </tableData>
      </table>
      </function>
      </set>
      <notify/>
    </event>


  </run>

  <output name="pq_rocket_output_raw.csv" type="CSV" rate="100" file="unitconversions.xml">
    <property>position/lat-gc-deg</property>
    <property>position/long-gc-deg</property>
    <property>position/h-sl-meters</property>
    <property>aero/alpha-rad</property>
    <property apply="convert-fps-To-ms" caption="velocities/vtrue-ms">velocities/vtrue-fps</property>
    <property apply="convert-fps-To-m_s" caption="velocities/vg-ms">velocities/vg-fps</property>
    <property apply="convert-rad-To-deg" caption="attitude/phi-deg">attitude/phi-rad</property>
    <property apply="convert-rad-To-deg" caption="attitude/theta-deg">attitude/theta-rad</property>
    <property apply="convert-rad-To-deg" caption="attitude/psi-deg">attitude/psi-rad</property>
    <property apply="convert-psf-To-Pa" caption="aero/qbar-Pa">aero/qbar-psf</property>
    <property>metrics/Sw-sqft</property>
  </output>
</runscript>