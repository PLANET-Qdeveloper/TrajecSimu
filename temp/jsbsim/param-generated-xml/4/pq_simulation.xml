<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="http://jsbsim.sf.net/JSBSimScript.xsl"?>
<runscript xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="http://jsbsim.sf.net/JSBSimScript.xsd"
    name="Rocket flight.">


  <use aircraft="PQ_ROCKET" initialize="liftoff"/> 

  <run start="0" end="300.0" dt="0.001">

    

    <!-- start off on the ground -->
    <property value="1"> forces/hold-down </property>

    <property value="0"> simulation/notify-time-trigger </property>

    <property value="100000000"> simulation/parachute_deploy_time </property>



    <!-- Ignite -->
    <event name="Ignition">
        <condition>simulation/sim-time-sec  ge  0.1</condition>
        <notify/>
    </event>

    <!-- Liftoff -->
    <event name="liftoff">
      <condition>simulation/sim-time-sec  ge  0.1</condition>
      <set name="forces/hold-down" value="0"/>
    </event>

    <!-- Burnout -->
    <event name="Motor Burnout">
      <condition>propulsion/tank[0]/contents-lbs lt 0.1</condition>
      <notify>
        <property caption="Time [s]">  simulation/sim-time-sec  </property>
        <property caption="Altitude [m]"> position/h-sl-meters  </property>
      </notify>
    </event>

    <!-- Zero Vertical Velocity -->
    <event name="Apogee">
      <condition>velocities/v-down-fps gt 1</condition>
      <notify>
        <property caption="Time [s]">  simulation/sim-time-sec  </property>
        <property caption="Altitude [m]"> position/h-sl-meters  </property>
      </notify>
      <set name="simulation/parachute_deploy_time" >
        <function>
          <sum>
            <property>simulation/sim-time-sec</property>
            <value>1.0</value>
          </sum>
        </function>
      </set>
    </event>

    <event name="Landed">
      <condition>position/h-agl-ft le 0.1</condition>
      <notify>
        <property caption="Time [s]">  simulation/sim-time-sec  </property>
        <property caption="Altitude [m]"> position/h-sl-meters  </property>
      </notify>
      <set name="simulation/terminate" value="1"/>
    </event>

    <event name="Winds aloft" continuous="true">
      <condition>simulation/sim-time-sec ge 0.001</condition>
      <set name="atmosphere/psiw-rad">
      <function>
      <table>
      <independentVar lookup="row"> position/h-agl-ft </independentVar>
      <tableData>
        0.0 0.0
        100.0 0.0
        200.0 0.0
        300.0 0.0
        400.0 0.0
        500.0 0.0
        600.0 0.0
        700.0 0.0
        800.0 0.0
        900.0 0.0
        1000.0 0.0
        1100.0 0.0
        1200.0 0.0
        1300.0 0.0
        1400.0 0.0
        1500.0 0.0
        1600.0 0.0
        1700.0 0.0
        1800.0 0.0
        1900.0 0.0
        2000.0 0.0
        2100.0 0.0
        2200.0 0.0
        2300.0 0.0
        2400.0 0.0
        2500.0 0.0
        2600.0 0.0
        2700.0 0.0
        2800.0 0.0
        2900.0 0.0
        3000.0 0.0
        3100.0 0.0
        3200.0 0.0
        3300.0 0.0
        3400.0 0.0
        3500.0 0.0
        3600.0 0.0
        3700.0 0.0
        3800.0 0.0
        3900.0 0.0
        4000.0 0.0
        4100.0 0.0
        4200.0 0.0
        4300.0 0.0
        4400.0 0.0
        4500.0 0.0
        4600.0 0.0
        4700.0 0.0
        4800.0 0.0
        4900.0 0.0
        5000.0 0.0
        5100.0 0.0
        5200.0 0.0
        5300.0 0.0
        5400.0 0.0
        5500.0 0.0
        5600.0 0.0
        5700.0 0.0
        5800.0 0.0
        5900.0 0.0
        6000.0 0.0
        6100.0 0.0
        6200.0 0.0
        6300.0 0.0
        6400.0 0.0
        6500.0 0.0
        6600.0 0.0
        6700.0 0.0
        6800.0 0.0
        6900.0 0.0
        7000.0 0.0
        7100.0 0.0
        7200.0 0.0
        7300.0 0.0
        7400.0 0.0
        7500.0 0.0
        7600.0 0.0
        7700.0 0.0
        7800.0 0.0
        7900.0 0.0
        8000.0 0.0
        8100.0 0.0
        8200.0 0.0
        8300.0 0.0
        8400.0 0.0
        8500.0 0.0
        8600.0 0.0
        8700.0 0.0
        8800.0 0.0
        8900.0 0.0
        9000.0 0.0
        9100.0 0.0
        9200.0 0.0
        9300.0 0.0
        9400.0 0.0
        9500.0 0.0
        9600.0 0.0
        9700.0 0.0
        9800.0 0.0
        9900.0 0.0
        10000.0 0.0
        
      </tableData>
      </table>
      </function>
      </set>
      <set name="atmosphere/wind-mag-fps">
      <function>
      <table>
      <independentVar lookup="row"> position/h-agl-ft </independentVar>
      <tableData>
        0.0 0.0
        100.0 21.412414700908275
        200.0 24.03462175379585
        300.0 25.714958230489984
        400.0 26.977949517460697
        500.0 28.000165610174545
        600.0 28.864063353782782
        700.0 29.615240437755137
        800.0 30.281723075243036
        900.0 30.88204137797664
        1000.0 31.42912179146434
        1100.0 31.932360530924353
        1200.0 32.39881417747539
        1300.0 32.83392463746339
        1400.0 33.241981906831434
        1500.0 33.62643116947938
        1600.0 33.9900833386991
        1700.0 34.33526345642387
        1800.0 34.66391781928531
        1900.0 34.977692935378094
        2000.0 35.27799479242227
        2100.0 35.56603407323732
        2200.0 35.84286115260281
        2300.0 36.109393538708915
        2400.0 36.36643764395749
        2500.0 36.61470624160596
        2600.0 36.85483259954782
        2700.0 37.08738202577625
        2800.0 37.31286137678478
        2900.0 37.53172694745628
        3000.0 37.74439106366671
        3100.0 37.95122762659667
        3200.0 38.15257680353904
        3300.0 38.34874901889676
        3400.0 38.54002836761198
        3500.0 38.72667554897989
        3600.0 38.908930399888355
        3700.0 39.087014091683734
        3800.0 39.26113104313125
        3900.0 39.43147059260031
        4000.0 39.598208465123875
        4100.0 39.76150806395084
        4200.0 39.92152161132086
        4300.0 40.07839115920567
        4400.0 40.23224948749427
        4500.0 40.38322090440971
        4600.0 40.531421961719005
        4700.0 40.67696209544817
        4800.0 40.819944201269614
        4900.0 40.960465152435326
        5000.0 41.09861626703963
        5100.0 41.23448373047607
        5200.0 41.36814897817307
        5300.0 41.49968904302983
        5400.0 41.629176871408546
        5500.0 41.7566816110542
        5600.0 41.88226887389772
        5700.0 42.00600097634011
        5800.0 42.127937159305766
        5900.0 42.24813379008567
        6000.0 42.366644547758604
        6100.0 42.483520593776326
        6200.0 42.59881072912188
        6300.0 42.71256153929648
        6400.0 42.82481752825429
        6500.0 42.93562124228651
        6600.0 43.04501338475089
        6700.0 43.153032922450976
        6800.0 43.25971718438764
        6900.0 43.36510195353339
        7000.0 43.46922155221588
        7100.0 43.57210892164
        7200.0 43.67379569602758
        7300.0 43.77431227180807
        7400.0 43.87368787225373
        7500.0 43.971950607916234
        7600.0 44.069127533189665
        7700.0 44.16524469929554
        7800.0 44.2603272039595
        7900.0 44.35439923802579
        8000.0 44.44748412923457
        8100.0 44.53960438336771
        8200.0 44.63078172295183
        8300.0 44.721037123691346
        8400.0 44.81039084879033
        8500.0 44.898862481309116
        8600.0 44.98647095468984
        8700.0 45.07323458157453
        8800.0 45.15917108102969
        8900.0 45.24429760428255
        9000.0 45.32863075906606
        9100.0 45.412186632662404
        9200.0 45.49498081372806
        9300.0 45.577028412977384
        9400.0 45.65834408279593
        9500.0 45.73894203584967
        9600.0 45.81883606275155
        9700.0 45.89803954884233
        9800.0 45.97656549013875
        9900.0 46.054426508498544
        10000.0 46.13163486604799
        
      </tableData>
      </table>
      </function>
      </set>
      <notify/>
    </event>


  </run>

  <output name="pq_rocket_output_raw.csv" type="CSV" rate="100" file="unitconversions.xml">
    <property>position/lat-gc-deg</property>
    <property>position/long-gc-deg</property>
    <property>position/h-sl-meters</property>
    <property>aero/alpha-rad</property>
    <property apply="convert-fps-To-ms" caption="velocities/vtrue-ms">velocities/vtrue-fps</property>
    <property apply="convert-fps-To-m_s" caption="velocities/vg-ms">velocities/vg-fps</property>
    <property apply="convert-rad-To-deg" caption="attitude/phi-deg">attitude/phi-rad</property>
    <property apply="convert-rad-To-deg" caption="attitude/theta-deg">attitude/theta-rad</property>
    <property apply="convert-rad-To-deg" caption="attitude/psi-deg">attitude/psi-rad</property>
    <property apply="convert-psf-To-Pa" caption="aero/qbar-Pa">aero/qbar-psf</property>
  </output>
</runscript>