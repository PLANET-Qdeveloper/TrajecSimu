<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="http://jsbsim.sf.net/JSBSimScript.xsl"?>
<runscript xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="http://jsbsim.sf.net/JSBSimScript.xsd"
    name="Rocket flight.">


  <use aircraft="PQ_ROCKET" initialize="liftoff"/> 

  <run start="0" end="300.0" dt="0.001">

    

    <!-- start off on the ground -->
    <property value="1"> forces/hold-down </property>

    <property value="0"> simulation/notify-time-trigger </property>

    <property value="100000000"> simulation/parachute_deploy_time </property>



    <!-- Ignite -->
    <event name="Ignition">
        <condition>simulation/sim-time-sec  ge  0.1</condition>
        <notify/>
    </event>

    <!-- Liftoff -->
    <event name="liftoff">
      <condition>simulation/sim-time-sec  ge  0.1</condition>
      <set name="forces/hold-down" value="0"/>
    </event>

    <!-- Burnout -->
    <event name="Motor Burnout">
      <condition>propulsion/tank[0]/contents-lbs lt 0.1</condition>
      <notify>
        <property caption="Time [s]">  simulation/sim-time-sec  </property>
        <property caption="Altitude [m]"> position/h-sl-meters  </property>
      </notify>
    </event>

    <!-- Zero Vertical Velocity -->
    <event name="Apogee">
      <condition>velocities/v-down-fps gt 1</condition>
      <notify>
        <property caption="Time [s]">  simulation/sim-time-sec  </property>
        <property caption="Altitude [m]"> position/h-sl-meters  </property>
      </notify>
      <set name="simulation/parachute_deploy_time" >
        <function>
          <sum>
            <property>simulation/sim-time-sec</property>
            <value>1.0</value>
          </sum>
        </function>
      </set>
    </event>

    <event name="Landed">
      <condition>position/h-agl-ft le 0.1</condition>
      <notify>
        <property caption="Time [s]">  simulation/sim-time-sec  </property>
        <property caption="Altitude [m]"> position/h-sl-meters  </property>
      </notify>
      <set name="simulation/terminate" value="1"/>
    </event>

    <event name="Winds aloft" continuous="true">
      <condition>simulation/sim-time-sec ge 0.001</condition>
      <set name="atmosphere/psiw-rad">
      <function>
      <table>
      <independentVar lookup="row"> position/h-agl-ft </independentVar>
      <tableData>
        0.0 4.712391
        100.0 4.712391
        200.0 4.712391
        300.0 4.712391
        400.0 4.712391
        500.0 4.712391
        600.0 4.712391
        700.0 4.712391
        800.0 4.712391
        900.0 4.712391
        1000.0 4.712391
        1100.0 4.712391
        1200.0 4.712391
        1300.0 4.712391
        1400.0 4.712391
        1500.0 4.712391
        1600.0 4.712391
        1700.0 4.712391
        1800.0 4.712391
        1900.0 4.712391
        2000.0 4.712391
        2100.0 4.712391
        2200.0 4.712391
        2300.0 4.712391
        2400.0 4.712391
        2500.0 4.712391
        2600.0 4.712391
        2700.0 4.712391
        2800.0 4.712391
        2900.0 4.712391
        3000.0 4.712391
        3100.0 4.712391
        3200.0 4.712391
        3300.0 4.712391
        3400.0 4.712391
        3500.0 4.712391
        3600.0 4.712391
        3700.0 4.712391
        3800.0 4.712391
        3900.0 4.712391
        4000.0 4.712391
        4100.0 4.712391
        4200.0 4.712391
        4300.0 4.712391
        4400.0 4.712391
        4500.0 4.712391
        4600.0 4.712391
        4700.0 4.712391
        4800.0 4.712391
        4900.0 4.712391
        5000.0 4.712391
        5100.0 4.712391
        5200.0 4.712391
        5300.0 4.712391
        5400.0 4.712391
        5500.0 4.712391
        5600.0 4.712391
        5700.0 4.712391
        5800.0 4.712391
        5900.0 4.712391
        6000.0 4.712391
        6100.0 4.712391
        6200.0 4.712391
        6300.0 4.712391
        6400.0 4.712391
        6500.0 4.712391
        6600.0 4.712391
        6700.0 4.712391
        6800.0 4.712391
        6900.0 4.712391
        7000.0 4.712391
        7100.0 4.712391
        7200.0 4.712391
        7300.0 4.712391
        7400.0 4.712391
        7500.0 4.712391
        7600.0 4.712391
        7700.0 4.712391
        7800.0 4.712391
        7900.0 4.712391
        8000.0 4.712391
        8100.0 4.712391
        8200.0 4.712391
        8300.0 4.712391
        8400.0 4.712391
        8500.0 4.712391
        8600.0 4.712391
        8700.0 4.712391
        8800.0 4.712391
        8900.0 4.712391
        9000.0 4.712391
        9100.0 4.712391
        9200.0 4.712391
        9300.0 4.712391
        9400.0 4.712391
        9500.0 4.712391
        9600.0 4.712391
        9700.0 4.712391
        9800.0 4.712391
        9900.0 4.712391
        10000.0 4.712391
        
      </tableData>
      </table>
      </function>
      </set>
      <set name="atmosphere/wind-mag-fps">
      <function>
      <table>
      <independentVar lookup="row"> position/h-agl-ft </independentVar>
      <tableData>
        0.0 0.0
        100.0 16.059311025681207
        200.0 18.02596631534689
        300.0 19.28621867286749
        400.0 20.233462138095526
        500.0 21.000124207630908
        600.0 21.648047515337087
        700.0 22.211430328316354
        800.0 22.711292306432277
        900.0 23.16153103348248
        1000.0 23.571841343598255
        1100.0 23.949270398193264
        1200.0 24.29911063310654
        1300.0 24.625443478097548
        1400.0 24.931486430123577
        1500.0 25.219823377109538
        1600.0 25.492562504024328
        1700.0 25.751447592317902
        1800.0 25.997938364463977
        1900.0 26.23326970153357
        2000.0 26.4584960943167
        2100.0 26.674525554927992
        2200.0 26.882145864452106
        2300.0 27.082045154031682
        2400.0 27.27482823296812
        2500.0 27.461029681204465
        2600.0 27.641124449660865
        2700.0 27.81553651933219
        2800.0 27.984646032588582
        2900.0 28.148795210592212
        3000.0 28.308293297750033
        3100.0 28.4634207199475
        3200.0 28.614432602654283
        3300.0 28.761561764172573
        3400.0 28.90502127570899
        3500.0 29.045006661734917
        3600.0 29.181697799916268
        3700.0 29.3152605687628
        3800.0 29.44584828234844
        3900.0 29.573602944450233
        4000.0 29.69865634884291
        4100.0 29.821131047963128
        4200.0 29.941141208490645
        4300.0 30.05879336940425
        4400.0 30.174187115620708
        4500.0 30.287415678307287
        4600.0 30.398566471289254
        4700.0 30.507721571586128
        4800.0 30.61495815095221
        4900.0 30.720348864326493
        5000.0 30.823962200279723
        5100.0 30.925862797857054
        5200.0 31.026111733629797
        5300.0 31.124766782272374
        5400.0 31.221882653556413
        5500.0 31.317511208290647
        5600.0 31.411701655423293
        5700.0 31.50450073225508
        5800.0 31.595952869479326
        5900.0 31.686100342564252
        6000.0 31.774983410818955
        6100.0 31.862640445332243
        6200.0 31.94910804684141
        6300.0 32.03442115447236
        6400.0 32.11861314619072
        6500.0 32.20171593171488
        6600.0 32.28376003856317
        6700.0 32.36477469183823
        6800.0 32.44478788829073
        6900.0 32.523826465150044
        7000.0 32.601916164161906
        7100.0 32.67908169123
        7200.0 32.75534677202068
        7300.0 32.83073420385605
        7400.0 32.905265904190294
        7500.0 32.97896295593717
        7600.0 33.05184564989225
        7700.0 33.12393352447166
        7800.0 33.195245402969626
        7900.0 33.265799428519344
        8000.0 33.335613096925925
        8100.0 33.404703287525784
        8200.0 33.47308629221387
        8300.0 33.540777842768506
        8400.0 33.60779313659275
        8500.0 33.674146860981836
        8600.0 33.73985321601738
        8700.0 33.804925936180894
        8800.0 33.86937831077227
        8900.0 33.93322320321191
        9000.0 33.99647306929955
        9100.0 34.0591399744968
        9200.0 34.12123561029605
        9300.0 34.18277130973304
        9400.0 34.243758062096944
        9500.0 34.304206526887256
        9600.0 34.36412704706366
        9700.0 34.42352966163175
        9800.0 34.48242411760407
        9900.0 34.540819881373906
        10000.0 34.59872614953599
        
      </tableData>
      </table>
      </function>
      </set>
      <notify/>
    </event>


  </run>

  <output name="pq_rocket_output_raw.csv" type="CSV" rate="100" file="unitconversions.xml">
    <property>position/lat-gc-deg</property>
    <property>position/long-gc-deg</property>
    <property>position/h-sl-meters</property>
    <property>aero/alpha-rad</property>
    <property apply="convert-fps-To-ms" caption="velocities/vtrue-ms">velocities/vtrue-fps</property>
    <property apply="convert-fps-To-m_s" caption="velocities/vg-ms">velocities/vg-fps</property>
    <property apply="convert-rad-To-deg" caption="attitude/phi-deg">attitude/phi-rad</property>
    <property apply="convert-rad-To-deg" caption="attitude/theta-deg">attitude/theta-rad</property>
    <property apply="convert-rad-To-deg" caption="attitude/psi-deg">attitude/psi-rad</property>
    <property apply="convert-psf-To-Pa" caption="aero/qbar-Pa">aero/qbar-psf</property>
  </output>
</runscript>