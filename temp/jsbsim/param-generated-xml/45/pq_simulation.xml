<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="http://jsbsim.sf.net/JSBSimScript.xsl"?>
<runscript xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="http://jsbsim.sf.net/JSBSimScript.xsd"
    name="Rocket flight.">


  <use aircraft="PQ_ROCKET" initialize="liftoff"/> 

  <run start="0" end="300.0" dt="0.001">

    

    <!-- start off on the ground -->
    <property value="1"> forces/hold-down </property>

    <property value="0"> simulation/notify-time-trigger </property>

    <property value="100000000"> simulation/parachute_deploy_time </property>



    <!-- Ignite -->
    <event name="Ignition">
        <condition>simulation/sim-time-sec  ge  0.1</condition>
        <notify/>
    </event>

    <!-- Liftoff -->
    <event name="liftoff">
      <condition>simulation/sim-time-sec  ge  0.1</condition>
      <set name="forces/hold-down" value="0"/>
    </event>

    <!-- Burnout -->
    <event name="Motor Burnout">
      <condition>propulsion/tank[0]/contents-lbs lt 0.1</condition>
      <notify>
        <property caption="Time [s]">  simulation/sim-time-sec  </property>
        <property caption="Altitude [m]"> position/h-sl-meters  </property>
      </notify>
    </event>

    <!-- Zero Vertical Velocity -->
    <event name="Apogee">
      <condition>velocities/v-down-fps gt 1</condition>
      <notify>
        <property caption="Time [s]">  simulation/sim-time-sec  </property>
        <property caption="Altitude [m]"> position/h-sl-meters  </property>
      </notify>
      <set name="simulation/parachute_deploy_time" >
        <function>
          <sum>
            <property>simulation/sim-time-sec</property>
            <value>1.0</value>
          </sum>
        </function>
      </set>
    </event>

    <event name="Landed">
      <condition>position/h-agl-ft le 0.1</condition>
      <notify>
        <property caption="Time [s]">  simulation/sim-time-sec  </property>
        <property caption="Altitude [m]"> position/h-sl-meters  </property>
      </notify>
      <set name="simulation/terminate" value="1"/>
    </event>

    <event name="Winds aloft" continuous="true">
      <condition>simulation/sim-time-sec ge 0.001</condition>
      <set name="atmosphere/psiw-rad">
      <function>
      <table>
      <independentVar lookup="row"> position/h-agl-ft </independentVar>
      <tableData>
        0.0 3.9269925000000003
        100.0 3.9269925000000003
        200.0 3.9269925000000003
        300.0 3.9269925000000003
        400.0 3.9269925000000003
        500.0 3.9269925000000003
        600.0 3.9269925000000003
        700.0 3.9269925000000003
        800.0 3.9269925000000003
        900.0 3.9269925000000003
        1000.0 3.9269925000000003
        1100.0 3.9269925000000003
        1200.0 3.9269925000000003
        1300.0 3.9269925000000003
        1400.0 3.9269925000000003
        1500.0 3.9269925000000003
        1600.0 3.9269925000000003
        1700.0 3.9269925000000003
        1800.0 3.9269925000000003
        1900.0 3.9269925000000003
        2000.0 3.9269925000000003
        2100.0 3.9269925000000003
        2200.0 3.9269925000000003
        2300.0 3.9269925000000003
        2400.0 3.9269925000000003
        2500.0 3.9269925000000003
        2600.0 3.9269925000000003
        2700.0 3.9269925000000003
        2800.0 3.9269925000000003
        2900.0 3.9269925000000003
        3000.0 3.9269925000000003
        3100.0 3.9269925000000003
        3200.0 3.9269925000000003
        3300.0 3.9269925000000003
        3400.0 3.9269925000000003
        3500.0 3.9269925000000003
        3600.0 3.9269925000000003
        3700.0 3.9269925000000003
        3800.0 3.9269925000000003
        3900.0 3.9269925000000003
        4000.0 3.9269925000000003
        4100.0 3.9269925000000003
        4200.0 3.9269925000000003
        4300.0 3.9269925000000003
        4400.0 3.9269925000000003
        4500.0 3.9269925000000003
        4600.0 3.9269925000000003
        4700.0 3.9269925000000003
        4800.0 3.9269925000000003
        4900.0 3.9269925000000003
        5000.0 3.9269925000000003
        5100.0 3.9269925000000003
        5200.0 3.9269925000000003
        5300.0 3.9269925000000003
        5400.0 3.9269925000000003
        5500.0 3.9269925000000003
        5600.0 3.9269925000000003
        5700.0 3.9269925000000003
        5800.0 3.9269925000000003
        5900.0 3.9269925000000003
        6000.0 3.9269925000000003
        6100.0 3.9269925000000003
        6200.0 3.9269925000000003
        6300.0 3.9269925000000003
        6400.0 3.9269925000000003
        6500.0 3.9269925000000003
        6600.0 3.9269925000000003
        6700.0 3.9269925000000003
        6800.0 3.9269925000000003
        6900.0 3.9269925000000003
        7000.0 3.9269925000000003
        7100.0 3.9269925000000003
        7200.0 3.9269925000000003
        7300.0 3.9269925000000003
        7400.0 3.9269925000000003
        7500.0 3.9269925000000003
        7600.0 3.9269925000000003
        7700.0 3.9269925000000003
        7800.0 3.9269925000000003
        7900.0 3.9269925000000003
        8000.0 3.9269925000000003
        8100.0 3.9269925000000003
        8200.0 3.9269925000000003
        8300.0 3.9269925000000003
        8400.0 3.9269925000000003
        8500.0 3.9269925000000003
        8600.0 3.9269925000000003
        8700.0 3.9269925000000003
        8800.0 3.9269925000000003
        8900.0 3.9269925000000003
        9000.0 3.9269925000000003
        9100.0 3.9269925000000003
        9200.0 3.9269925000000003
        9300.0 3.9269925000000003
        9400.0 3.9269925000000003
        9500.0 3.9269925000000003
        9600.0 3.9269925000000003
        9700.0 3.9269925000000003
        9800.0 3.9269925000000003
        9900.0 3.9269925000000003
        10000.0 3.9269925000000003
        
      </tableData>
      </table>
      </function>
      </set>
      <set name="atmosphere/wind-mag-fps">
      <function>
      <table>
      <independentVar lookup="row"> position/h-agl-ft </independentVar>
      <tableData>
        0.0 0.0
        100.0 26.765518376135343
        200.0 30.043277192244815
        300.0 32.143697788112476
        400.0 33.72243689682587
        500.0 35.00020701271818
        600.0 36.08007919222848
        700.0 37.01905054719393
        800.0 37.852153844053795
        900.0 38.6025517224708
        1000.0 39.28640223933043
        1100.0 39.91545066365544
        1200.0 40.49851772184423
        1300.0 41.04240579682924
        1400.0 41.55247738353929
        1500.0 42.03303896184923
        1600.0 42.48760417337388
        1700.0 42.91907932052983
        1800.0 43.329897274106635
        1900.0 43.72211616922262
        2000.0 44.09749349052784
        2100.0 44.457542591546655
        2200.0 44.80357644075352
        2300.0 45.13674192338614
        2400.0 45.45804705494686
        2500.0 45.768382802007444
        2600.0 46.06854074943477
        2700.0 46.35922753222032
        2800.0 46.641076720980976
        2900.0 46.91465868432035
        3000.0 47.180488829583396
        3100.0 47.439034533245845
        3200.0 47.69072100442381
        3300.0 47.935936273620946
        3400.0 48.17503545951497
        3500.0 48.40834443622487
        3600.0 48.636162999860446
        3700.0 48.858767614604666
        3800.0 49.076413803914065
        3900.0 49.28933824075039
        4000.0 49.49776058140484
        4100.0 49.70188507993855
        4200.0 49.90190201415108
        4300.0 50.09798894900709
        4400.0 50.29031185936784
        4500.0 50.47902613051214
        4600.0 50.66427745214875
        4700.0 50.846202619310205
        4800.0 51.02493025158702
        4900.0 51.20058144054416
        5000.0 51.37327033379953
        5100.0 51.543104663095086
        5200.0 51.71018622271633
        5300.0 51.87461130378728
        5400.0 52.03647108926069
        5500.0 52.19585201381775
        5600.0 52.352836092372144
        5700.0 52.507501220425134
        5800.0 52.659921449132206
        5900.0 52.81016723760709
        6000.0 52.95830568469825
        6100.0 53.1044007422204
        6200.0 53.24851341140235
        6300.0 53.39070192412059
        6400.0 53.53102191031786
        6500.0 53.66952655285814
        6600.0 53.80626673093861
        6700.0 53.94129115306372
        6800.0 54.07464648048455
        6900.0 54.206377441916736
        7000.0 54.33652694026985
        7100.0 54.46513615205
        7200.0 54.59224462003447
        7300.0 54.71789033976009
        7400.0 54.842109840317164
        7500.0 54.9649382598953
        7600.0 55.08640941648708
        7700.0 55.20655587411943
        7800.0 55.32540900494937
        7900.0 55.44299904753224
        8000.0 55.5593551615432
        8100.0 55.674505479209635
        8200.0 55.78847715368978
        8300.0 55.901296404614186
        8400.0 56.01298856098791
        8500.0 56.123578101636404
        8600.0 56.233088693362305
        8700.0 56.34154322696816
        8800.0 56.448963851287104
        8900.0 56.555372005353185
        9000.0 56.66078844883257
        9100.0 56.765233290828
        9200.0 56.86872601716008
        9300.0 56.97128551622173
        9400.0 57.07293010349491
        9500.0 57.17367754481209
        9600.0 57.27354507843945
        9700.0 57.372549436052914
        9800.0 57.47070686267344
        9900.0 57.56803313562318
        10000.0 57.664543582559986
        
      </tableData>
      </table>
      </function>
      </set>
      <notify/>
    </event>


  </run>

  <output name="pq_rocket_output_raw.csv" type="CSV" rate="100" file="unitconversions.xml">
    <property>position/lat-gc-deg</property>
    <property>position/long-gc-deg</property>
    <property>position/h-sl-meters</property>
    <property>aero/alpha-rad</property>
    <property apply="convert-fps-To-ms" caption="velocities/vtrue-ms">velocities/vtrue-fps</property>
    <property apply="convert-fps-To-m_s" caption="velocities/vg-ms">velocities/vg-fps</property>
    <property apply="convert-rad-To-deg" caption="attitude/phi-deg">attitude/phi-rad</property>
    <property apply="convert-rad-To-deg" caption="attitude/theta-deg">attitude/theta-rad</property>
    <property apply="convert-rad-To-deg" caption="attitude/psi-deg">attitude/psi-rad</property>
    <property apply="convert-psf-To-Pa" caption="aero/qbar-Pa">aero/qbar-psf</property>
    <property>metrics/Sw-sqft</property>
  </output>
</runscript>