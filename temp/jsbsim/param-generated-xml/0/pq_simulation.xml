<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="http://jsbsim.sf.net/JSBSimScript.xsl"?>
<runscript xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="http://jsbsim.sf.net/JSBSimScript.xsd"
    name="Rocket flight.">


  <use aircraft="PQ_ROCKET" initialize="liftoff"/> 

  <run start="0" end="300.0" dt="0.001">

    

    <!-- start off on the ground -->
    <property value="1"> forces/hold-down </property>

    <property value="0"> simulation/notify-time-trigger </property>

    <property value="100000000"> simulation/parachute_deploy_time </property>



    <!-- Ignite -->
    <event name="Ignition">
        <condition>simulation/sim-time-sec  ge  0.1</condition>
        <notify/>
    </event>

    <!-- Liftoff -->
    <event name="liftoff">
      <condition>simulation/sim-time-sec  ge  0.1</condition>
      <set name="forces/hold-down" value="0"/>
    </event>

    <!-- Burnout -->
    <event name="Motor Burnout">
      <condition>propulsion/tank[0]/contents-lbs lt 0.1</condition>
      <notify>
        <property caption="Time [s]">  simulation/sim-time-sec  </property>
        <property caption="Altitude [m]"> position/h-sl-meters  </property>
      </notify>
    </event>

    <!-- Zero Vertical Velocity -->
    <event name="Apogee">
      <condition>velocities/v-down-fps gt 1</condition>
      <notify>
        <property caption="Time [s]">  simulation/sim-time-sec  </property>
        <property caption="Altitude [m]"> position/h-sl-meters  </property>
      </notify>
      <set name="simulation/parachute_deploy_time" >
        <function>
          <sum>
            <property>simulation/sim-time-sec</property>
            <value>1.0</value>
          </sum>
        </function>
      </set>
    </event>

    <event name="Landed">
      <condition>position/h-agl-ft le 0.1</condition>
      <notify>
        <property caption="Time [s]">  simulation/sim-time-sec  </property>
        <property caption="Altitude [m]"> position/h-sl-meters  </property>
      </notify>
      <set name="simulation/terminate" value="1"/>
    </event>

    <event name="Winds aloft" continuous="true">
      <condition>simulation/sim-time-sec ge 0.001</condition>
      <set name="atmosphere/psiw-rad">
      <function>
      <table>
      <independentVar lookup="row"> position/h-agl-ft </independentVar>
      <tableData>
        0.0 0.0
        100.0 0.0
        200.0 0.0
        300.0 0.0
        400.0 0.0
        500.0 0.0
        600.0 0.0
        700.0 0.0
        800.0 0.0
        900.0 0.0
        1000.0 0.0
        1100.0 0.0
        1200.0 0.0
        1300.0 0.0
        1400.0 0.0
        1500.0 0.0
        1600.0 0.0
        1700.0 0.0
        1800.0 0.0
        1900.0 0.0
        2000.0 0.0
        2100.0 0.0
        2200.0 0.0
        2300.0 0.0
        2400.0 0.0
        2500.0 0.0
        2600.0 0.0
        2700.0 0.0
        2800.0 0.0
        2900.0 0.0
        3000.0 0.0
        3100.0 0.0
        3200.0 0.0
        3300.0 0.0
        3400.0 0.0
        3500.0 0.0
        3600.0 0.0
        3700.0 0.0
        3800.0 0.0
        3900.0 0.0
        4000.0 0.0
        4100.0 0.0
        4200.0 0.0
        4300.0 0.0
        4400.0 0.0
        4500.0 0.0
        4600.0 0.0
        4700.0 0.0
        4800.0 0.0
        4900.0 0.0
        5000.0 0.0
        5100.0 0.0
        5200.0 0.0
        5300.0 0.0
        5400.0 0.0
        5500.0 0.0
        5600.0 0.0
        5700.0 0.0
        5800.0 0.0
        5900.0 0.0
        6000.0 0.0
        6100.0 0.0
        6200.0 0.0
        6300.0 0.0
        6400.0 0.0
        6500.0 0.0
        6600.0 0.0
        6700.0 0.0
        6800.0 0.0
        6900.0 0.0
        7000.0 0.0
        7100.0 0.0
        7200.0 0.0
        7300.0 0.0
        7400.0 0.0
        7500.0 0.0
        7600.0 0.0
        7700.0 0.0
        7800.0 0.0
        7900.0 0.0
        8000.0 0.0
        8100.0 0.0
        8200.0 0.0
        8300.0 0.0
        8400.0 0.0
        8500.0 0.0
        8600.0 0.0
        8700.0 0.0
        8800.0 0.0
        8900.0 0.0
        9000.0 0.0
        9100.0 0.0
        9200.0 0.0
        9300.0 0.0
        9400.0 0.0
        9500.0 0.0
        9600.0 0.0
        9700.0 0.0
        9800.0 0.0
        9900.0 0.0
        10000.0 0.0
        
      </tableData>
      </table>
      </function>
      </set>
      <set name="atmosphere/wind-mag-fps">
      <function>
      <table>
      <independentVar lookup="row"> position/h-agl-ft </independentVar>
      <tableData>
        0.0 0.0
        100.0 0.0
        200.0 0.0
        300.0 0.0
        400.0 0.0
        500.0 0.0
        600.0 0.0
        700.0 0.0
        800.0 0.0
        900.0 0.0
        1000.0 0.0
        1100.0 0.0
        1200.0 0.0
        1300.0 0.0
        1400.0 0.0
        1500.0 0.0
        1600.0 0.0
        1700.0 0.0
        1800.0 0.0
        1900.0 0.0
        2000.0 0.0
        2100.0 0.0
        2200.0 0.0
        2300.0 0.0
        2400.0 0.0
        2500.0 0.0
        2600.0 0.0
        2700.0 0.0
        2800.0 0.0
        2900.0 0.0
        3000.0 0.0
        3100.0 0.0
        3200.0 0.0
        3300.0 0.0
        3400.0 0.0
        3500.0 0.0
        3600.0 0.0
        3700.0 0.0
        3800.0 0.0
        3900.0 0.0
        4000.0 0.0
        4100.0 0.0
        4200.0 0.0
        4300.0 0.0
        4400.0 0.0
        4500.0 0.0
        4600.0 0.0
        4700.0 0.0
        4800.0 0.0
        4900.0 0.0
        5000.0 0.0
        5100.0 0.0
        5200.0 0.0
        5300.0 0.0
        5400.0 0.0
        5500.0 0.0
        5600.0 0.0
        5700.0 0.0
        5800.0 0.0
        5900.0 0.0
        6000.0 0.0
        6100.0 0.0
        6200.0 0.0
        6300.0 0.0
        6400.0 0.0
        6500.0 0.0
        6600.0 0.0
        6700.0 0.0
        6800.0 0.0
        6900.0 0.0
        7000.0 0.0
        7100.0 0.0
        7200.0 0.0
        7300.0 0.0
        7400.0 0.0
        7500.0 0.0
        7600.0 0.0
        7700.0 0.0
        7800.0 0.0
        7900.0 0.0
        8000.0 0.0
        8100.0 0.0
        8200.0 0.0
        8300.0 0.0
        8400.0 0.0
        8500.0 0.0
        8600.0 0.0
        8700.0 0.0
        8800.0 0.0
        8900.0 0.0
        9000.0 0.0
        9100.0 0.0
        9200.0 0.0
        9300.0 0.0
        9400.0 0.0
        9500.0 0.0
        9600.0 0.0
        9700.0 0.0
        9800.0 0.0
        9900.0 0.0
        10000.0 0.0
        
      </tableData>
      </table>
      </function>
      </set>
      <notify/>
    </event>


  </run>

  <output name="pq_rocket_output_raw.csv" type="CSV" rate="100" file="unitconversions.xml">
    <property>position/lat-gc-deg</property>
    <property>position/long-gc-deg</property>
    <property>position/h-sl-meters</property>
    <property>aero/alpha-rad</property>
    <property apply="convert-fps-To-ms" caption="velocities/vtrue-ms">velocities/vtrue-fps</property>
    <property apply="convert-fps-To-m_s" caption="velocities/vg-ms">velocities/vg-fps</property>
    <property apply="convert-rad-To-deg" caption="attitude/phi-deg">attitude/phi-rad</property>
    <property apply="convert-rad-To-deg" caption="attitude/theta-deg">attitude/theta-rad</property>
    <property apply="convert-rad-To-deg" caption="attitude/psi-deg">attitude/psi-rad</property>
    <property apply="convert-psf-To-Pa" caption="aero/qbar-Pa">aero/qbar-psf</property>
    <property>metrics/Sw-sqft</property>
  </output>
</runscript>