<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="http://jsbsim.sf.net/JSBSimScript.xsl"?>
<runscript xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="http://jsbsim.sf.net/JSBSimScript.xsd"
    name="Rocket flight.">


  <use aircraft="PQ_ROCKET" initialize="liftoff"/> 

  <run start="0" end="300.0" dt="0.001">

    

    <!-- start off on the ground -->
    <property value="1"> forces/hold-down </property>

    <property value="0"> simulation/notify-time-trigger </property>

    <property value="100000000"> simulation/parachute_deploy_time </property>



    <!-- Ignite -->
    <event name="Ignition">
        <condition>simulation/sim-time-sec  ge  0.1</condition>
        <notify/>
    </event>

    <!-- Liftoff -->
    <event name="liftoff">
      <condition>simulation/sim-time-sec  ge  0.1</condition>
      <set name="forces/hold-down" value="0"/>
    </event>

    <!-- Burnout -->
    <event name="Motor Burnout">
      <condition>propulsion/tank[0]/contents-lbs lt 0.1</condition>
      <notify>
        <property caption="Time [s]">  simulation/sim-time-sec  </property>
        <property caption="Altitude [m]"> position/h-sl-meters  </property>
      </notify>
    </event>

    <!-- Zero Vertical Velocity -->
    <event name="Apogee">
      <condition>velocities/v-down-fps gt 1</condition>
      <notify>
        <property caption="Time [s]">  simulation/sim-time-sec  </property>
        <property caption="Altitude [m]"> position/h-sl-meters  </property>
      </notify>
      <set name="simulation/parachute_deploy_time" >
        <function>
          <sum>
            <property>simulation/sim-time-sec</property>
            <value>1.0</value>
          </sum>
        </function>
      </set>
    </event>

    <event name="Landed">
      <condition>position/h-agl-ft le 0.1</condition>
      <notify>
        <property caption="Time [s]">  simulation/sim-time-sec  </property>
        <property caption="Altitude [m]"> position/h-sl-meters  </property>
      </notify>
      <set name="simulation/terminate" value="1"/>
    </event>

    <event name="Winds aloft" continuous="true">
      <condition>simulation/sim-time-sec ge 0.001</condition>
      <set name="atmosphere/psiw-rad">
      <function>
      <table>
      <independentVar lookup="row"> position/h-agl-ft </independentVar>
      <tableData>
        0.0 2.3561955
        100.0 2.3561955
        200.0 2.3561955
        300.0 2.3561955
        400.0 2.3561955
        500.0 2.3561955
        600.0 2.3561955
        700.0 2.3561955
        800.0 2.3561955
        900.0 2.3561955
        1000.0 2.3561955
        1100.0 2.3561955
        1200.0 2.3561955
        1300.0 2.3561955
        1400.0 2.3561955
        1500.0 2.3561955
        1600.0 2.3561955
        1700.0 2.3561955
        1800.0 2.3561955
        1900.0 2.3561955
        2000.0 2.3561955
        2100.0 2.3561955
        2200.0 2.3561955
        2300.0 2.3561955
        2400.0 2.3561955
        2500.0 2.3561955
        2600.0 2.3561955
        2700.0 2.3561955
        2800.0 2.3561955
        2900.0 2.3561955
        3000.0 2.3561955
        3100.0 2.3561955
        3200.0 2.3561955
        3300.0 2.3561955
        3400.0 2.3561955
        3500.0 2.3561955
        3600.0 2.3561955
        3700.0 2.3561955
        3800.0 2.3561955
        3900.0 2.3561955
        4000.0 2.3561955
        4100.0 2.3561955
        4200.0 2.3561955
        4300.0 2.3561955
        4400.0 2.3561955
        4500.0 2.3561955
        4600.0 2.3561955
        4700.0 2.3561955
        4800.0 2.3561955
        4900.0 2.3561955
        5000.0 2.3561955
        5100.0 2.3561955
        5200.0 2.3561955
        5300.0 2.3561955
        5400.0 2.3561955
        5500.0 2.3561955
        5600.0 2.3561955
        5700.0 2.3561955
        5800.0 2.3561955
        5900.0 2.3561955
        6000.0 2.3561955
        6100.0 2.3561955
        6200.0 2.3561955
        6300.0 2.3561955
        6400.0 2.3561955
        6500.0 2.3561955
        6600.0 2.3561955
        6700.0 2.3561955
        6800.0 2.3561955
        6900.0 2.3561955
        7000.0 2.3561955
        7100.0 2.3561955
        7200.0 2.3561955
        7300.0 2.3561955
        7400.0 2.3561955
        7500.0 2.3561955
        7600.0 2.3561955
        7700.0 2.3561955
        7800.0 2.3561955
        7900.0 2.3561955
        8000.0 2.3561955
        8100.0 2.3561955
        8200.0 2.3561955
        8300.0 2.3561955
        8400.0 2.3561955
        8500.0 2.3561955
        8600.0 2.3561955
        8700.0 2.3561955
        8800.0 2.3561955
        8900.0 2.3561955
        9000.0 2.3561955
        9100.0 2.3561955
        9200.0 2.3561955
        9300.0 2.3561955
        9400.0 2.3561955
        9500.0 2.3561955
        9600.0 2.3561955
        9700.0 2.3561955
        9800.0 2.3561955
        9900.0 2.3561955
        10000.0 2.3561955
        
      </tableData>
      </table>
      </function>
      </set>
      <set name="atmosphere/wind-mag-fps">
      <function>
      <table>
      <independentVar lookup="row"> position/h-agl-ft </independentVar>
      <tableData>
        0.0 0.0
        100.0 5.353103675227069
        200.0 6.0086554384489625
        300.0 6.428739557622496
        400.0 6.744487379365174
        500.0 7.000041402543636
        600.0 7.216015838445696
        700.0 7.403810109438784
        800.0 7.570430768810759
        900.0 7.72051034449416
        1000.0 7.857280447866085
        1100.0 7.983090132731088
        1200.0 8.099703544368847
        1300.0 8.208481159365848
        1400.0 8.310495476707858
        1500.0 8.406607792369845
        1600.0 8.497520834674775
        1700.0 8.583815864105967
        1800.0 8.665979454821327
        1900.0 8.744423233844524
        2000.0 8.819498698105567
        2100.0 8.89150851830933
        2200.0 8.960715288150702
        2300.0 9.027348384677229
        2400.0 9.091609410989372
        2500.0 9.15367656040149
        2600.0 9.213708149886955
        2700.0 9.271845506444063
        2800.0 9.328215344196195
        2900.0 9.38293173686407
        3000.0 9.436097765916678
        3100.0 9.487806906649167
        3200.0 9.53814420088476
        3300.0 9.58718725472419
        3400.0 9.635007091902995
        3500.0 9.681668887244973
        3600.0 9.727232599972089
        3700.0 9.771753522920934
        3800.0 9.815282760782813
        3900.0 9.857867648150078
        4000.0 9.899552116280969
        4100.0 9.94037701598771
        4200.0 9.980380402830216
        4300.0 10.019597789801418
        4400.0 10.058062371873568
        4500.0 10.095805226102428
        4600.0 10.132855490429751
        4700.0 10.169240523862042
        4800.0 10.204986050317403
        4900.0 10.240116288108831
        5000.0 10.274654066759908
        5100.0 10.308620932619018
        5200.0 10.342037244543267
        5300.0 10.374922260757458
        5400.0 10.407294217852137
        5500.0 10.43917040276355
        5600.0 10.47056721847443
        5700.0 10.501500244085028
        5800.0 10.531984289826442
        5900.0 10.562033447521417
        6000.0 10.591661136939651
        6100.0 10.620880148444082
        6200.0 10.64970268228047
        6300.0 10.67814038482412
        6400.0 10.706204382063573
        6500.0 10.733905310571627
        6600.0 10.761253346187722
        6700.0 10.788258230612744
        6800.0 10.81492929609691
        6900.0 10.841275488383348
        7000.0 10.86730538805397
        7100.0 10.89302723041
        7200.0 10.918448924006896
        7300.0 10.943578067952018
        7400.0 10.968421968063433
        7500.0 10.992987651979059
        7600.0 11.017281883297416
        7700.0 11.041311174823885
        7800.0 11.065081800989875
        7900.0 11.088599809506448
        8000.0 11.111871032308642
        8100.0 11.134901095841927
        8200.0 11.157695430737958
        8300.0 11.180259280922836
        8400.0 11.202597712197582
        8500.0 11.224715620327279
        8600.0 11.24661773867246
        8700.0 11.268308645393633
        8800.0 11.289792770257423
        8900.0 11.311074401070638
        9000.0 11.332157689766515
        9100.0 11.353046658165601
        9200.0 11.373745203432016
        9300.0 11.394257103244346
        9400.0 11.414586020698982
        9500.0 11.434735508962417
        9600.0 11.454709015687888
        9700.0 11.474509887210582
        9800.0 11.494141372534688
        9900.0 11.513606627124636
        10000.0 11.532908716511997
        
      </tableData>
      </table>
      </function>
      </set>
      <notify/>
    </event>


  </run>

  <output name="pq_rocket_output_raw.csv" type="CSV" rate="100" file="unitconversions.xml">
    <property>position/lat-gc-deg</property>
    <property>position/long-gc-deg</property>
    <property>position/h-sl-meters</property>
    <property>aero/alpha-rad</property>
    <property apply="convert-fps-To-ms" caption="velocities/vtrue-ms">velocities/vtrue-fps</property>
    <property apply="convert-fps-To-m_s" caption="velocities/vg-ms">velocities/vg-fps</property>
    <property apply="convert-rad-To-deg" caption="attitude/phi-deg">attitude/phi-rad</property>
    <property apply="convert-rad-To-deg" caption="attitude/theta-deg">attitude/theta-rad</property>
    <property apply="convert-rad-To-deg" caption="attitude/psi-deg">attitude/psi-rad</property>
    <property apply="convert-psf-To-Pa" caption="aero/qbar-Pa">aero/qbar-psf</property>
  </output>
</runscript>