<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="http://jsbsim.sf.net/JSBSimScript.xsl"?>
<runscript xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="http://jsbsim.sf.net/JSBSimScript.xsd"
    name="Rocket flight.">


  <use aircraft="PQ_ROCKET" initialize="liftoff"/> 

  <run start="0" end="100" dt="0.001">

    

    <!-- start off on the ground -->
    <property value="1"> forces/hold-down </property>

    <property value="0"> simulation/notify-time-trigger </property>

    <!-- Ignite -->
    <event name="Ignition">
        <condition>simulation/sim-time-sec  ge  0.1</condition>
        <set name="fcs/throttle-cmd-norm[0]" value="1.0"/>
        <notify/>
    </event>

    <!-- Liftoff -->
    <event name="liftoff">
      <condition>forces/fbx-prop-lbs gt inertia/weight-lbs</condition>
      <set name="forces/hold-down" value="0"/>
    </event>

    <!-- Burnout -->
    <event name="Motor Burnout">
      <condition>propulsion/tank[0]/contents-lbs lt 0.1</condition>
      <notify>
        <property caption="Time [s]">  simulation/sim-time-sec  </property>
        <property caption="Altitude [m]"> position/h-sl-meters  </property>
        <property caption="Vertical velocity [fps]"> velocities/v-down-fps </property>
      </notify>
    </event>

    <!-- Zero Vertical Velocity -->
    <event name="Apogee">
      <condition>velocities/v-down-fps gt 1</condition>
      <notify>
        <property caption="Time [s]">  simulation/sim-time-sec  </property>
        <property caption="Altitude [m]"> position/h-sl-meters  </property>
      </notify>
    </event>

    <event name="Winds aloft" continuous="true">
      <condition>simulation/sim-time-sec ge 0.05</condition>
      <set name="atmosphere/psiw-rad">
      <function>
      <table>
      <independentVar lookup="row"> position/h-agl-ft </independentVar>
      <tableData>
        <!-- Alt (ft) Dir (rad) -->
        0.0 0.80
        5000.0 0.90
        10000.0 1.0
        20000.0 0.70
        25000.0 0.80
        30000.0 0.90
        35000.0 1.00
        40000.0 1.10
        45000.0 1.20
        50000.0 1.30
        55000.0 1.40
        60000.0 1.30
        65000.0 1.20
        70000.0 1.30
        100000.0 1.40
        200000.0 1.50
      </tableData>
      </table>
      </function>
      </set>
      <set name="atmosphere/wind-mag-fps">
      <function>
      <table>
      <independentVar lookup="row"> position/h-agl-ft </independentVar>
      <tableData>
        <!-- Alt (ft) Speed (fps) -->
        0.0 10.0
        5000.0 40.0
        10000.0 60.0
        15000.0 120.0
        20000.0 135.0
        25000.0 140.0
        30000.0 130.0
        35000.0 120.0
        40000.0 110.0
        45000.0 110.0
        50000.0 100.0
        55000.0 90.0
        60000.0 85.0
        65000.0 60.0
        70000.0 40.0
        100000.0 10.0
        200000.0 5.0
      </tableData>
      </table>
      </function>
      </set>
      <notify/>
    </event>


    <event name="Repeating Notify" persistent="true">
      <description>Output message at 5 second intervals</description>
      <notify>
        <property apply="convert-lbs-To-N" caption="propulsion/engine[0]/thrust-N">propulsion/engine[0]/thrust-lbs</property>
        <property apply="convert-lbs-To-kg" caption="propulsion/tank[0]/contents-kg">propulsion/tank[0]/contents-lbs</property>
        <property>position/h-agl-ft</property>
        <property>velocities/vc-kts</property>
        <property>velocities/vc-fps</property>
        <property>velocities/vt-fps</property>
        <property apply="convert-rad-To-deg" caption="attitude/phi-deg">attitude/phi-rad</property>
        <property apply="convert-rad-To-deg" caption="attitude/theta-deg">attitude/theta-rad</property>
        <property apply="convert-rad-To-deg" caption="attitude/psi-deg">attitude/psi-rad</property>
      </notify>
      <condition> simulation/sim-time-sec >= simulation/notify-time-trigger </condition>
      <set name="simulation/notify-time-trigger" value="5" type="FG_DELTA"/>
    </event>

  </run>

  <output name="pq_rocket_output.csv" type="CSV" rate="10" file="unitconversions.xml">
    <property apply="convert-lbs-To-N" caption="propulsion/engine[0]/thrust-N">propulsion/engine[0]/thrust-lbs</property>
    <property apply="convert-lbs-To-kg" caption="propulsion/tank[0]/contents-kg">propulsion/tank[0]/contents-lbs</property>
    <property apply="convert-lbs-To-kg" caption="propulsion/tank[1]/contents-kg">propulsion/tank[1]/contents-lbs</property>
    <property apply="convert-ft-To-m" caption="position/h-agl-m">position/h-agl-ft</property>
    <property apply="convert-kts-To-ms" caption="velocities/vc-ms">velocities/vc-kts</property>
    <property apply="convert-kts-To-ms" caption="velocities/vt-ms">velocities/vt-kts</property>
    <property apply="convert-rad-To-deg" caption="attitude/phi-deg">attitude/phi-rad</property>
    <property apply="convert-rad-To-deg" caption="attitude/theta-deg">attitude/theta-rad</property>
    <property apply="convert-rad-To-deg" caption="attitude/psi-deg">attitude/psi-rad</property>
  </output>

</runscript>